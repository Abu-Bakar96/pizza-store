{"ast":null,"code":"import _objectSpread from\"/home/admin1/carier week/react-pizza-v2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/home/admin1/carier week/react-pizza-v2/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/home/admin1/carier week/react-pizza-v2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/home/admin1/carier week/react-pizza-v2/node_modules/@babel/runtime/regenerator/index.js\";import React from'react';import qs from'qs';import{useSelector}from'react-redux';import{Categories,Sort,PizzaBlock,Skeleton,Pagination}from'../components';import{list}from'../components/Sort';import{useNavigate}from'react-router-dom';import{useAppDispatch}from'../redux/store';import{selectFilter}from'../redux/filter/selectors';import{selectPizzaData}from'../redux/pizza/selectors';import{setCategoryId,setCurrentPage,setFilters}from'../redux/filter/slice';import{fetchPizzas}from'../redux/pizza/asyncActions';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var navigate=useNavigate();var dispatch=useAppDispatch();var isSearch=React.useRef(false);var isMounted=React.useRef(false);var _useSelector=useSelector(selectPizzaData),items=_useSelector.items,status=_useSelector.status;var _useSelector2=useSelector(selectFilter),categoryId=_useSelector2.categoryId,sort=_useSelector2.sort,currentPage=_useSelector2.currentPage,searchValue=_useSelector2.searchValue;var onChangeCategory=React.useCallback(function(idx){dispatch(setCategoryId(idx));},[]);var onChangePage=function onChangePage(page){dispatch(setCurrentPage(page));};var getPizzas=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var order,sortBy,category,search;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:order=sort.sortProperty.includes('-')?'asc':'desc';sortBy=sort.sortProperty.replace('-','');category=categoryId>0?\"category=\".concat(categoryId):'';search=searchValue?\"&search=\".concat(searchValue):'';dispatch(fetchPizzas({order:order,sortBy:sortBy,category:category,search:search,currentPage:String(currentPage)}));case 5:case\"end\":return _context.stop();}}},_callee);}));return function getPizzas(){return _ref.apply(this,arguments);};}();// –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –±—ã–ª –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä\nReact.useEffect(function(){if(isMounted.current){var queryString=qs.stringify({sortProperty:sort.sortProperty,categoryId:categoryId,currentPage:currentPage});navigate(\"/?\".concat(queryString));}isMounted.current=true;},[categoryId,sort.sortProperty,currentPage]);// –ï—Å–ª–∏ –±—ã–ª –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä, —Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º URL-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ä–µ–¥—É–∫—Å–µ\nReact.useEffect(function(){if(window.location.search){var params=qs.parse(window.location.search.substring(1));var _sort=list.find(function(obj){return obj.sortProperty===params.sortBy;});dispatch(setFilters({searchValue:params.search,categoryId:Number(params.category),currentPage:Number(params.currentPage),sort:_sort||list[0]}));isSearch.current=true;}},[]);// –ï—Å–ª–∏ –±—ã–ª –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä, —Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–∏—Ü—Ü—ã \nReact.useEffect(function(){window.scrollTo(0,0);if(!isSearch.current){getPizzas();}isSearch.current=false;},[categoryId,sort.sortProperty,searchValue,currentPage]);var skeletons=_toConsumableArray(new Array(6)).map(function(_,index){return/*#__PURE__*/_jsx(Skeleton,{},index);});var pizzas=items.map(function(obj){return/*#__PURE__*/_jsx(PizzaBlock,_objectSpread({},obj),obj.id);});return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{value:categoryId,onChangeCategory:onChangeCategory}),/*#__PURE__*/_jsx(Sort,{value:sort})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),status==='error'?/*#__PURE__*/_jsxs(\"div\",{className:\"content__error-info\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430 \\uD83D\\uDE15\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E, \\u043D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u043F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043F\\u0438\\u0446\\u0446\\u044B. \\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435.\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:status==='loading'?skeletons:pizzas}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,onChangePage:onChangePage})]});};export default Home;","map":{"version":3,"names":["React","qs","useSelector","Categories","Sort","PizzaBlock","Skeleton","Pagination","list","useNavigate","useAppDispatch","selectFilter","selectPizzaData","setCategoryId","setCurrentPage","setFilters","fetchPizzas","Home","navigate","dispatch","isSearch","useRef","isMounted","items","status","categoryId","sort","currentPage","searchValue","onChangeCategory","useCallback","idx","onChangePage","page","getPizzas","order","sortProperty","includes","sortBy","replace","category","search","String","useEffect","current","queryString","stringify","window","location","params","parse","substring","find","obj","Number","scrollTo","skeletons","Array","map","_","index","pizzas","id"],"sources":["/home/admin1/carier week/react-pizza-v2/src/pages/Home.tsx"],"sourcesContent":["import React from 'react'\nimport qs from 'qs'\nimport { useSelector } from 'react-redux';\n\n\n\nimport { Categories, Sort, PizzaBlock, Skeleton, Pagination } from '../components'\n\nimport {list} from '../components/Sort';\nimport { useNavigate } from 'react-router-dom';\nimport { useAppDispatch } from '../redux/store';\nimport { selectFilter } from '../redux/filter/selectors';\nimport { selectPizzaData } from '../redux/pizza/selectors';\nimport { setCategoryId, setCurrentPage, setFilters } from '../redux/filter/slice';\nimport { fetchPizzas } from '../redux/pizza/asyncActions';\nimport { SearchPizzaParams } from '../redux/pizza/types';\n\nconst Home: React.FC = () => {\n  const navigate = useNavigate()\n  const dispatch = useAppDispatch()\n  const isSearch = React.useRef(false)\n  const isMounted = React.useRef(false)\n\n  const {items, status} = useSelector(selectPizzaData)\n\n  const { categoryId, sort, currentPage, searchValue } = useSelector(selectFilter)\n\n\n\n\n  const onChangeCategory = React.useCallback((idx: number) => {\n    dispatch(setCategoryId(idx))\n  }, [])\n\n  const onChangePage = (page: number) => {\n    dispatch(setCurrentPage(page))\n  }\n\n  const getPizzas = async () => {\n    const order = sort.sortProperty.includes('-') ? 'asc' : 'desc';\n    const sortBy = sort.sortProperty.replace('-', '')\n    const category = categoryId > 0 ? `category=${categoryId}` : ''\n    const search = searchValue ? `&search=${searchValue}` : ''\n\n    dispatch(\n      fetchPizzas({\n        order,\n        sortBy,\n        category,\n        search,\n        currentPage: String(currentPage),\n      }),\n    )\n}\n\n  // –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –±—ã–ª –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä\n\n  React.useEffect(() => {\n\n    if(isMounted.current) {\n\n      const queryString = qs.stringify({\n        sortProperty: sort.sortProperty,\n        categoryId,\n        currentPage\n  \n      })\n  \n      navigate(`/?${queryString}`)\n\n    }\n    \n    isMounted.current = true\n\n  }, [categoryId, sort.sortProperty, currentPage])\n\n  // –ï—Å–ª–∏ –±—ã–ª –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä, —Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º URL-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ä–µ–¥—É–∫—Å–µ\n  React.useEffect(() => {\n    if (window.location.search) {\n      const params = qs.parse(window.location.search.substring(1)) as unknown as SearchPizzaParams;\n      const sort = list.find(obj => obj.sortProperty === params.sortBy)\n\n\n      dispatch(setFilters({\n        searchValue: params.search,\n        categoryId: Number(params.category),\n        currentPage: Number(params.currentPage),\n        sort: sort || list[0]\n\n      }))\n      isSearch.current = true\n    }\n  },[])\n\n  // –ï—Å–ª–∏ –±—ã–ª –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä, —Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–∏—Ü—Ü—ã \n  React.useEffect(() => {\n    window.scrollTo(0, 0)\n    if (!isSearch.current) {\n      getPizzas()\n    }\n\n    isSearch.current = false\n\n  }, [categoryId, sort.sortProperty, searchValue, currentPage])\n\n\n\n  const skeletons = [...new Array(6)].map((_, index) => <Skeleton key={index} />)\n\n  const pizzas = items.map((obj: any) => <PizzaBlock key={obj.id} {...obj} />)\n  \n\n  return (\n    <div className=\"container\">\n\n      <div className=\"content__top\">\n        <Categories value={categoryId} onChangeCategory={onChangeCategory} />\n        <Sort value = {sort} />\n\n      </div>\n      <h2 className=\"content__title\">–í—Å–µ –ø–∏—Ü—Ü—ã</h2>\n\n      { status === 'error' ?\n       (<div className=\"content__error-info\">\n        <h2>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ üòï</h2>\n        <p>\n          –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–∏—Ü—Ü—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ.\n        </p>\n      </div>\n      ) : (\n      <div className=\"content__items\">\n\n        {\n        status === 'loading'\n        ? skeletons\n        : pizzas\n        }\n\n        </div>)}\n      \n      <Pagination currentPage={currentPage} onChangePage={onChangePage} />\n    </div>\n  )\n}\n\nexport default Home"],"mappings":"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"},"metadata":{},"sourceType":"module"}